profiles:
  - git://store-systems-devops:wcnp-profiles:main:all-metrics
  - java-runtime
  - goldensignal-strati
  - git://Logistics:metrics-profiles:main:wmAzureSql-sam-metrics
  - git://Logistics:atlas-kitt-assets:main:deploy/argus-metrics
  - git://data-access-frameworks:metric-profiles:main:azure-sql/v1/jdbcDriverMetrics
  - git://data-access-frameworks:metric-profiles:main:common/v1/jvmMetrics
  - git://data-access-frameworks:metric-profiles:main:azure-sql/v1/goldenSignalMetrics
deploy:
  releaseType:
    strategy: normal
    deployTimeout: 2000
    waitForReady: true
    rollbackOnError: true
  gslb:
    httpPortEnabled: true
    httpsPortEnabled: true
    healthCheckDefaults:
      expectedStatus: 200
      timeout: 5
      retryDelay: 5
      probeInterval: 20
      failureThreshold: 2
    strategy: stage
    enabled: true
  helm:
    values:
      metadata:
        annotations:
          traffic.sidecar.istio.io/excludeOutboundPorts: 8080,7766
      secrets:
        akeyless: true
        engine: eso
        config:
          akeyless:
            path:
              WCNP: /Prod/WCNP/homeoffice/GLS-Receiving-Atlas/receiving-api/{{$.kittExec.currentStage.name}}
              DPS: /Non-Prod/DPS/homeoffice/Tridents-SE
        files:
          - destination: /receiving-secrets.properties
            content: secrets.key
          - destination: /gls-atlas-receiving.jks
            content: truststore.key
            base64decode: true
          - destination: /gls-atlas-receiving-taas.jks
            content: taastruststore.key
            base64decode: true
          - destination: /signature.properties
            content: servicemesh.config
            base64decode: true
          - destination: /receiving-sumo.properties
            content: sumo.config
            base64decode: true
      livenessProbe:
        path: "/heartbeat"
        wait: 60
        periodSeconds: 10
        successThreshold: 1
        failureThreshold: 30
      readinessProbe:
        path: "/heartbeat"
        wait: 60
        periodSeconds: 10
        successThreshold: 1
        failureThreshold: 30
      global:
        metrics:
          enabled: true
          endpoints:
            - targetPort: 8080
              path: "/prometheus"
            - targetPort: 7766
              path: "/metrics"
          remoteWriteSampleLimit: 250
          whitelist:
            - dcFinExceptionCount_total
            - receiveContainersTimed_seconds
            - quantityChangeTimed_seconds
            - publishReceiveEventTimed_seconds
            - Endgame_PrintAck_seconds
            - Endgame_PrintAck_Exception_total
            - Endgame_ScanAck_seconds
            - Endgame_ScanAck_Exception_total
            - Endgame_PreGen_seconds
            - Endgame_PreGen_total
            - SLT_Get_Divert_seconds
            - SLT_Get_Divert_Exception_total
            - GDM_Get_Delivery_seconds
            - GDM_Get_Delivery_Exception_total
            - Endgame_Channel_Flip_seconds
            - Endgame_Channel_Flip_Exception_total
            - Endgame_ScanUPC_seconds
            - Endgame_ScanUPC_Exception_total
            - HKW_TCL_Upload_seconds
            - HKW_TCL_Upload_Exception_total
            - Manual_TCL_Gen_seconds
            - instructionResponseSummaryExceptionCount_total
            - instructionResponseSummaryTimed_seconds
            - Manual_TCL_Gen_Exception_total
            - Endgame_AuditFlip_seconds
            - Endgame_AuditFlip_Exception_total
            - kafkaListenerExceptionCount_total
            - HKW_Divert_Upload_seconds
            - heartBeatHitCount_total
            - instructionRequestHitCount_total
            - instructionRequestTimed_seconds
            - OFrequestTimed_seconds
            - idmCallTimed_seconds
            - OFrequestCount_total
            - completeInstructionTimed_seconds
            - updateInstructionTimed_seconds
            - completeDeliveryTimed_seconds
            - OFrequestExceptionCount_total
            - noAllocationException_total
            - completeInstructionExceptionCount_total
            - backoutReceiptsExceptionCount_total
            - instructionRequestExceptionCount_total
            - instructionFromDBTimed_seconds
            - updateInstructionExceptionCount_total
            - receivedQtySummaryByPOForDeliveryTimed_seconds
            - idmCallExceptionCount_total
            - jmsPublishTimed_seconds
            - completeDeliveryExceptionCount_total
            - heartBeatTimed_seconds
            - jmsPublishExceptionCount_total
            - receivedQtySummaryByPOForDeliveryExceptionCount_total
            - completeProblemTagExceptionCount_total
            - uwms_Exception_alert_Reqs_total
            - cancelInstructionTimed_seconds
            - heartBeatExceptionCount_total
            - completeProblemTagTimed_seconds
            - receivedQtySummaryByPOForDeliveryHitCount_total
            - cancelContainersTimed_seconds
            - cancelInstructionExceptionCount_total
            - cancelContainersExceptionCount_total
            - getProblemTagDetailsTimed_seconds
            - transferInstructionHitCount_total
            - getProblemTagDetailsExceptionCount_total
            - reOpenDeliveryExceptionCount_total
            - jmsListenerExceptionCount_total
            - reOpenDeliveryTimed_seconds
            - transferInstructionExceptionCount_total
            - idmCallByAsnTimed_seconds
            - transferInstructionTimed_seconds
            - idmCallByAsnExceptionCount_total
            - preLabelGenTimed_seconds
            - ReceiveByLpnTimed_seconds
            - preLabelGenExceptionCount_total
            - ReceiveByLpnExceptionCount_total
            - plgSchedulerExceptionCount_total
            - plgSchedulerTimed_seconds
            - userLocAPIExceptionCount_total
            - userLocAPITimed_seconds
            - aclNotificationExceptionCount_total
            - receiveDockTagExceptionCount_total
            - completeDockTagExceptionCount_total
            - floorLineSummaryExceptionCount_total
            - exceptionLabelAPIExceptionCount_total
            - aclNotificationHistoryExceptionCount_total
            - aclNotificationHistoryHitCount_total
            - fetchLabelsFromACLExceptionCount_total
            - updateVendorUpcExceptionCount_total
            - OFRetryRequestTimed_seconds
            - OFRetryRequestExceptionCount_total
            - getDeliveryDetailsExceptionCount_total
            - getDoorInfoExceptionCount_total
            - retrieveLPNExceptionCount_total
            - retrieveLPNTimed_seconds
            - findDeliveryDocumentExceptionCount_total
            - findDeliveryDocumentTimed_seconds
            - sendSumoNotificationExceptionCount_total
            - rcTrackItemTimed_seconds
            - rcTrackItemExceptionCount_total
            - rcTrackPackageTimed_seconds
            - rcTrackPackageExceptionCount_total
            - rcReceiveContainerTimed_seconds
            - rcReceiveContainerExceptionCount_total
            - rcGetContainerByGtinTimed_seconds
            - rcGetContainerByGtinExceptionCount_total
            - processShipmentTimed_seconds
            - processShipmentExceptionCount_total
            - receivePalletTimed_seconds
            - receivePalletCount_total
            - putAwayTimed_seconds
            - receivePalletExceptionCount_total
            - putAwayExceptionCount_total
            - mapLPNTimed_seconds
            - putAwayCTTimed_seconds
            - mapLPNExceptionCount_total
            - putAwayCTExceptionCount_total
            - getCTStatusTimed_seconds
            - getCTStatusExceptionCount_total
            - getAllItemsTimed_seconds
            - getAllItemsExceptionCount_total
            - acquireSlotTimes_seconds
            - updateVendorUPCTimed_seconds
            - linkDeliveryAndShipmentByGtinAndLotNumberTimed_seconds
            - findDeliveryDocumentByGtinAndLotNumberWithShipmentLinkingTimed_seconds
            - findDeliveryDocumentBySSCCWithShipmentLinkingTimed_seconds
            - findDeliveryDocumentBySSCCWithShipmentLinkinExceptionCount_total
            - findDeliveryDocumentByGtinAndLotNumberWithShipmentLinkingExceptionCount_total
            - getDeliveryTimed_seconds
            - updateQuantityByTrackingIdTimed_seconds
            - receiveContainersExceptionCount_total
            - quantityChangeExceptionCount_total
            - publishReceiveEventExceptionCounted_total
            - palletsOffHoldTimed_seconds
            - verifySerializedDataTimed_seconds
            - verifySerializedDataExceptionCounted_total
            - acquireSlotExceptionCount_total
            - searchShipmentTimed_seconds
            - searchShipmentExceptionCount_total
            - searchShipmentsByDeliveryAndGtinAndLotNumberFromGdmTimed_seconds
            - searchShipmentsByDeliveryAndGtinAndLotNumberFromGdmExceptionCount_total
            - linkDeliveryAndShipmentByGtinAndLotNumberExceptionCount_total
            - getShipmentsByGtinAndLotNumberFromGdmTimed_seconds
            - getShipmentsByGtinAndLotNumberFromGdmExceptionCount_total
            - findDeliveryDocumentsByGtinAndLotNumberTimed_seconds
            - findDeliveryDocumentsByGtinAndLotNumberExceptionCount_total
            - linkDeliveryWithShipmentTimed_seconds
            - linkDeliveryWithShipmentExceptionCount_total
            - getContainerSsccDetailsTimed_seconds
            - getContainerSsccDetailsExceptionCount_total
            - findDeliveryDocumentBySSCCWithLatestShipmentLinking_seconds
            - findDeliveryDocumentBySSCCWithLatestShipmentLinkingExceptionCount_total
            - RdcItemCatalogAPIExceptionCount_total
            - createRdcDockTagTimed_seconds
            - createRdcDockTagExceptionCount_total
            - receiveRdcDockTagTimed_seconds
            - receiveRdcDockTagExceptionCount_total
            - rdcCompleteDockTagTimed_seconds
            - rdcCompleteDockTagExceptionCount_total
            - RdcItemCatalogAPITimed_seconds
            - RdcPublishAPITimed_seconds
            - RdcPublishAPIExceptionCount_total
            - quantityReceivedTimed_seconds
            - quantityReceivedExceptionCount_total
            - getReceivedQtySummaryByPoTimed_seconds
            - getReceivedQtySummaryByPoExceptionCount_total
            - getReceivedQtySummaryByPoLineTimed_seconds
            - getReceivedQtySummaryByPoLineExceptionCount_total
            - itemDetailsTimed_seconds
            - itemDetailsExceptionCount_total
            - voidLPNTimed_seconds
            - voidLPNExceptionCount_total
            - notifyBackoutAdjustmentTimed_seconds
            - notifyBackoutAdjustmentCount_total
            - notifyReceivingCorrectionAdjustmentTimed_seconds
            - notifyReceivingCorrectionAdjustmentCount_total
            - getDeliveryByURITimed_seconds
            - getDeliveryByURIExceptionCount_total
            - updateVendorUpcInNGRTimed_seconds
            - updateVendorUpcInNGRCount_total
            - rdcRetrieveLPNTimed_seconds
            - rdcRetrieveLPNExceptionCount_total
            - receivePalletSlottingHitCount_total
            - receivePalletSlottingTimed_seconds
            - receivePalletSlottingExceptionCount_total
            - getPrimeSlotForSplitPalletTimed_seconds
            - getPrimeSlotForSplitPalletCount_total
            - getPrimeSlotForSplitPalletExceptionCount_total
            - getPrimeSlotByDocumentLineHitCount_total
            - getPrimeSlotByDocumentLineTimed_seconds
            - getPrimeSlotByDocumentLineExceptionCount_total
            - getPrimeSlotByItemNumbersHitCount_total
            - getPrimeSlotByItemNumbersTimed_seconds
            - getPrimeSlotByItemNumbersExceptionCount_total
            - getSlotTimed_seconds
            - getSlotExceptionCount_total
            - deliveryNGRReceiptsTimed_seconds
            - deliveryNGRReceiptsExceptionCount_total
            - scanProblemTagAPITimed_seconds
            - scanProblemTagAPIExceptionCount_total
            - getProblemTagAPITimed_seconds
            - getProblemTagAPIExceptionCount_total
            - getProblemTagHitCount_total
            - updateProblemReceivedQtyAPITimed_seconds
            - updateProblemReceivedQtyAPIExceptionCount_total
            - updateProblemReceivedQtyHitCount_total
            - createProblemTagAPITimed_seconds
            - createProblemTagAPIExceptionCount_total
            - createProblemTagHitCount_total
            - reportProblemErrorAPITimed_seconds
            - reportProblemErrorAPIExceptionCount_total
            - reportProblemErrorHitCount_total
            - getPOLineInfoFromGdmAPITimed_seconds
            - getPOLineInfoFromGdmAPIExceptionCount_total
            - getPOLineInfoFromGdmHitCount_total
            - searchAtlasConvertedItemsAPITimed_seconds
            - searchAtlasConvertedItemsExceptionCount_total
            - searchAtlasConvertedItemsHitCount_total
            - getDoorInfoTimed_seconds
            - manualMFCDeliveryProcessingTimed_seconds
            - manualMFCDeliveryProcessingExceptionCount_total
            - manualMFCContainerPublishingTimed_seconds
            - manualMFCContainerPublishingExceptionCount_total
            - autoMFCDeliveryProcessingTimed_seconds
            - autoMFCDeliveryProcessingExceptionCount_total
            - autoMFCDecantTimed_seconds
            - autoMFCDecantExceptionCount_total
            - autoMFCExceptionReceiptCreationTimed_seconds
            - autoMFCExceptionReceiptCreationExceptionCount_total
            - mfcContainerCreationTimed_seconds
            - mfcASNDownloadTimed_seconds
            - mfcASNDownloadExceptionCount_total
            - mfcReceiptCreationTimed_seconds
            - mfcReceiptCreationExceptionCount_total
            - mfcInventoryProcessingTimed_seconds
            - mfcInventoryProcessingExceptionCount_total
            - damageInventoryReportTimed_seconds
            - damageInventoryReportExceptionCount_total
            - getAllContainersByDeliveryTimed_seconds
            - getAllContainersByDeliveryExceptionCount_total
            - dcFinV2ExceptionCount_total
            - dcFinReconReceiptsRetryExceptionCount_total
            - dcFinReceiptsForDeliveryExceptionCount_total
            - JMS_MESSAGE_PUBLISHING_EXCEPTION_COUNT_total
            - DCFIN_PURCHASE_POSTING_EXCEPTION_COUNT_total
            - DCFIN_PO_CLOSE_EXCEPTION_COUNT_total
            - GDM_PO_FINALIZE_EXCEPTION_COUNT_total
            - INVENTORY_RECEIPT_RECEIVE_CORRECTION_EXCEPTION_COUNT_total
            - INVENTORY_UPDATE_PO_DETAILS_EXCEPTION_COUNT_total
            - INVENTORY_UPDATE_LOCATION_EXCEPTION_COUNT_total
            - wrongUOM_detected_total
            - storeInboundFailedPackCreation_total
            - manualMfcFailedPackCreation_total
            - autoMfcFailedPackCreation_total
            - duplicate_container_item_total
            - storeInboundMixedPalletProcessingTimed_seconds
            - storeInboundMixedPalletProcessingExceptionCount_total
            - retry_exhausted_total
            - mixed_pallet_not_found_total
            - receiveInstructionTimed_seconds
            - confirmPurchaseOrdersTimed_seconds
            - receiveInstructionExceptionCount_total
            - confirmPurchaseOrdersExceptionCount_total
            - mfc_inventory_adjustment_failed_total
            - RdcAutoReceiveContainersAPITimed_seconds
            - RdcAutoReceiveContainersAPIExceptionTimed_total
            - getReceiptQtySummaryByDeliveriesTimed_seconds
            - getReceiptQtySummaryByDeliveries_total
            - getReceiptQtySummaryByPoNumbersTimed_seconds
            - getReceiptQtySummaryByPoNumbers_total
            - failedInventoryBulkAdjustment_total
            - itemOverrideTimed_seconds
            - itemOverrideExceptionCount_total
            - receiveInstructionByDeliveryDocumentTimed_seconds
            - receiveInstructionByDeliveryDocumentExceptionCount_total
            - dsdcReceiveTimed_seconds
            - dsdcReceiveExceptionCount_total
            - dsdcReceiveHitCount_total
            - security_cert_x509_expiration_seconds
            - http_requests_total
            - http_requests_count
            - http_requests_timed_bucket
            - method_calls_total
            - method_calls_count
            - method_calls_timed_bucket
            - listener_calls_count
            - listener_calls_timed_bucket
            - listener_calls_total
            - http_requests_timed_seconds
            - method_calls_timed_seconds
            - listener_calls_timed_seconds
            - client_calls_count
            - client_calls_timed_bucket
            - printingBackoutTimed_seconds
            - printingBackoutExceptionCount_total

      releaseType:
        strategy:
          rollingUpdate:
            maxSurge: "66%"
            maxUnavailable: "25%"
  postDeploy:
    - task:
        name: messageSlack
        text: |
          Deployment details* :
          > Namespace: *{{ $.kitt.deploy.namespace }}*
          > Cluster: *{{$.kittExec.currentCluster.clusterId}}*
          > Zone: *{{$.kittExec.currentCluster.zone}}*